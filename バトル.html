<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚¿ãƒƒãƒ—æ ¼é—˜ã‚²ãƒ¼ãƒ  Ver.2</title>
    <style>
        /* --- åŸºæœ¬è¨­å®š --- */
        body {
            font-family: sans-serif;
            margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh;
            background-color: #222; /* èƒŒæ™¯è‰²ï¼šæš—ã„ã‚°ãƒ¬ãƒ¼ */
            color: white;
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢ */
            touch-action: manipulation;
        }

        /* --- ä½“åŠ›ã‚²ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ --- */
        .hud {
            display: flex; justify-content: space-between; padding: 15px; background: #333;
        }
        .hp-container { width: 45%; font-weight: bold; }
        .hp-bar-bg {
            width: 100%; height: 20px; background: #555; border: 3px solid #444; border-radius: 4px; overflow: hidden;
        }
        .hp-bar { height: 100%; transition: width 0.2s ease-out; }
        #hp-p1 { background: linear-gradient(to right, #00c6ff, #0072ff); width: 100%; }
        #hp-p2 { background: linear-gradient(to right, #ff4b1f, #ff9068); width: 100%; }

        /* --- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢ (ã‚¹ãƒ†ãƒ¼ã‚¸) --- */
        .stage {
            flex-grow: 1;
            display: flex; justify-content: space-around; align-items: flex-end; /* è¶³å…ƒã‚’æƒãˆã‚‹ */
            padding-bottom: 50px;
            position: relative;
            background: #2a2a2a; /* åœ°é¢ã®è‰² */
            box-shadow: inset 0 -10px 20px rgba(0,0,0,0.5);
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
        .fighter {
            width: 100px; height: 150px;
            border-radius: 15px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            font-size: 50px; /* çµµæ–‡å­—ã®ã‚µã‚¤ã‚º */
            position: relative;
            transition: all 0.1s; /* ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã®æ»‘ã‚‰ã‹ã• */
            border: 5px solid rgba(0,0,0,0.2);
        }
        .p1-base { background: #0072ff; color: white; }
        .p2-base { background: #ff4b1f; color: white; }
        .fighter .name { font-size: 16px; position: absolute; top: -25px; font-weight: bold;}

        /* --- ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¨çŠ¶æ…‹å¤‰åŒ– (ãƒãƒ¼ã‚º) --- */

        /* æ”»æ’ƒæ™‚ï¼šå°‘ã—å‰ã«å‡ºã‚‹ */
        .pose-attack.p1-base { transform: translateX(30px); }
        .pose-attack.p2-base { transform: translateX(-30px); }

        /* ãƒ€ãƒ¡ãƒ¼ã‚¸æ™‚ï¼šè‰²ãŒæ˜ã‚‹ããªã‚Šã€æºã‚Œã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè¿½åŠ ã•ã‚Œã‚‹ */
        .pose-hurt { filter: brightness(1.5); }
        .shake { animation: shakeAnim 0.3s linear; }

        @keyframes shakeAnim {
            0% { transform: translate(0, 0); }
            20% { transform: translate(-10px, 0) rotate(-2deg); }
            40% { transform: translate(10px, 0) rotate(2deg); }
            60% { transform: translate(-10px, 0) rotate(-2deg); }
            80% { transform: translate(10px, 0) rotate(2deg); }
            100% { transform: translate(0, 0); }
        }
        
        /* æ•—åŒ—æ™‚ï¼šå€’ã‚Œã¦è‰²ãŒæš—ããªã‚‹ */
        .pose-lose {
            transform: rotate(90deg) translate(40px, 0);
            filter: grayscale(100%) brightness(0.5);
            transition: transform 0.5s ease-in;
        }
        /* å‹åˆ©æ™‚ï¼šå°‘ã—è·³ã­ã‚‹ */
        .pose-win {
            transform: translateY(-30px);
            box-shadow: 0 20px 10px rgba(0,0,0,0.3);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* ãƒã‚¦ãƒ³ãƒ‰ã™ã‚‹å‹•ã */
        }


        /* --- æ“ä½œãƒ‘ãƒãƒ«ã‚¨ãƒªã‚¢ --- */
        .controls {
            height: 35%; display: flex; border-top: 3px solid #444;
        }
        .control-pad {
            width: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center;
            gap: 12px; padding: 10px;
        }
        .p1-pad { background: #002244; }
        .p2-pad { background: #441100; }

        button {
            width: 95%; padding: 18px; font-size: 20px; border: none; border-radius: 12px;
            font-weight: bold; cursor: pointer; position: relative;
            box-shadow: 0 6px 0 rgba(0,0,0,0.4); /* ç«‹ä½“æ„Ÿ */
            transition: all 0.05s;
        }
        button:active {
            top: 6px; box-shadow: 0 0 0 rgba(0,0,0,0.4); /* æŠ¼ã—ãŸã¨ãã®æ²ˆã¿è¾¼ã¿ */
        }

        .btn-punch { background: linear-gradient(to bottom, #ffeb3b, #fbc02d); color: black; }
        .btn-kick { background: linear-gradient(to bottom, #ff5722, #e64a19); color: white; }
        
        /* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ */
        #reset-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); display: none;
            justify-content: center; align-items: center; flex-direction: column; z-index: 100;
        }
        #win-message { font-size: 40px; color: yellow; margin-bottom: 30px; font-weight: bold; text-shadow: 2px 2px 4px black; }
        #reset-btn { padding: 20px 50px; font-size: 24px; background: white; color: black; width: auto; }
    </style>
</head>
<body>

    <div class="hud">
        <div class="hp-container">
            <div>PLAYER 1</div>
            <div class="hp-bar-bg"><div id="hp-p1" class="hp-bar"></div></div>
        </div>
        <div class="hp-container" style="text-align: right;">
            <div>PLAYER 2</div>
            <div class="hp-bar-bg"><div id="hp-p2" class="hp-bar" style="float: right;"></div></div>
        </div>
    </div>

    <div class="stage">
        <div id="char-p1" class="fighter p1-base">
            <div class="name">P1</div>
            <span class="face">ğŸ˜</span>
        </div>
        <div id="char-p2" class="fighter p2-base">
            <div class="name">P2</div>
            <span class="face">ğŸ˜</span>
        </div>
    </div>

    <div class="controls">
        <div class="control-pad p1-pad">
            <button class="btn-punch" onclick="handleAction(1, 'punch')">ğŸ‘Š ãƒ‘ãƒ³ãƒ (å°)</button>
            <button class="btn-kick" onclick="handleAction(1, 'kick')">ğŸ¦¶ ã‚­ãƒƒã‚¯ (å¤§)</button>
        </div>
        <div class="control-pad p2-pad">
            <button class="btn-punch" onclick="handleAction(2, 'punch')">ğŸ‘Š ãƒ‘ãƒ³ãƒ (å°)</button>
            <button class="btn-kick" onclick="handleAction(2, 'kick')">ğŸ¦¶ ã‚­ãƒƒã‚¯ (å¤§)</button>
        </div>
    </div>

    <div id="reset-overlay">
        <div id="win-message">P1 WINS!</div>
        <button id="reset-btn" onclick="resetGame()">ã‚‚ã†ä¸€åº¦æˆ¦ã†</button>
    </div>

    <script>
        // === ã‚²ãƒ¼ãƒ è¨­å®š ===
        const MAX_HP = 100;
        const DAMAGE_PUNCH = 17; // 6ç™ºã§KO
        const DAMAGE_KICK = 25;  // 4ç™ºã§KO

        // === ã‚²ãƒ¼ãƒ çŠ¶æ…‹ ===
        let gameState = {
            hp1: MAX_HP,
            hp2: MAX_HP,
            isGameOver: false
        };

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ç”¨ã‚¿ã‚¤ãƒãƒ¼ï¼ˆé€£æ‰“ã—ãŸã¨ãã«å‰ã®å‹•ãã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ãŸã‚ï¼‰
        let p1AnimTimeout, p2AnimTimeout;

        // === ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç† (ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—) ===
        function handleAction(attackerId, type) {
            if (gameState.isGameOver) return;

            const targetId = (attackerId === 1) ? 2 : 1;
            const damage = (type === 'punch') ? DAMAGE_PUNCH : DAMAGE_KICK;

            // 1. ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
            if (targetId === 1) {
                gameState.hp1 = Math.max(0, gameState.hp1 - damage);
            } else {
                gameState.hp2 = Math.max(0, gameState.hp2 - damage);
            }

            // 2. ç”»é¢æ›´æ–°ï¼ˆHPãƒãƒ¼ï¼‰
            updateHpUI();

            // 3. å‹æ•—åˆ¤å®š
            if (gameState.hp1 <= 0 || gameState.hp2 <= 0) {
                endGame(attackerId);
            } else {
                // å‹è² ãŒã¤ã„ã¦ã„ãªã‘ã‚Œã°ã€æ”»æ’ƒã¨ãƒ€ãƒ¡ãƒ¼ã‚¸ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å†ç”Ÿ
                playAttackAnimations(attackerId, targetId);
            }
        }

        // === ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡é–¢æ•° ===
        
        // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¦‹ãŸç›®ï¼ˆãƒãƒ¼ã‚ºã¨é¡”ï¼‰ã‚’å¤‰æ›´ã™ã‚‹é–¢æ•°
        function setCharacterPose(playerId, poseType) {
            const charEl = document.getElementById(`char-p${playerId}`);
            const faceEl = charEl.querySelector('.face');
            
            // ã„ã£ãŸã‚“å…¨ã¦ã®ãƒãƒ¼ã‚ºã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            charEl.classList.remove('pose-idle', 'pose-attack', 'pose-hurt', 'pose-win', 'pose-lose');
            // æŒ‡å®šã•ã‚ŒãŸãƒãƒ¼ã‚ºã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            charEl.classList.add(`pose-${poseType}`);

            // ãƒãƒ¼ã‚ºã«å¿œã˜ã¦çµµæ–‡å­—ã‚’å¤‰æ›´
            let emoji = 'ğŸ˜';
            switch(poseType) {
                case 'idle': emoji = 'ğŸ˜'; break;
                case 'attack': emoji = 'ğŸ˜ '; break;
                case 'hurt': emoji = 'ğŸ˜µ'; break;
                case 'win': emoji = 'ğŸ˜'; break;
                case 'lose': emoji = 'ğŸ’€'; break;
            }
            faceEl.textContent = emoji;
        }

        // æ”»æ’ƒæ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒ¼ã‚±ãƒ³ã‚¹
        function playAttackAnimations(attackerId, targetId) {
            const targetEl = document.getElementById(`char-p${targetId}`);
            
            // å‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
            clearTimeout(attackerId === 1 ? p1AnimTimeout : p2AnimTimeout);
            clearTimeout(targetId === 1 ? p1AnimTimeout : p2AnimTimeout);

            // --- æ”»æ’ƒå´ã®å‹•ã ---
            setCharacterPose(attackerId, 'attack');
            // å°‘ã—çµŒã£ãŸã‚‰å…ƒã®å§¿å‹¢ã«æˆ»ã™ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆ
            const attackerTimer = setTimeout(() => {
                if(!gameState.isGameOver) setCharacterPose(attackerId, 'idle');
            }, 200); // 0.2ç§’å¾Œã«æˆ»ã‚‹

            // --- é˜²å¾¡å´ã®å‹•ã ---
            setCharacterPose(targetId, 'hurt');
            // æºã‚Œã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³CSSã‚¯ãƒ©ã‚¹ã‚’ä»˜ä¸ã—ã¦ã€ã™ãå¤–ã™ï¼ˆå†ç”Ÿã•ã›ã‚‹ãŸã‚ï¼‰
            targetEl.classList.remove('shake');
            void targetEl.offsetWidth; // ãƒ–ãƒ©ã‚¦ã‚¶ã«å†æç”»ã‚’å¼·åˆ¶ã™ã‚‹ãƒãƒƒã‚¯
            targetEl.classList.add('shake');

            // å°‘ã—çµŒã£ãŸã‚‰å…ƒã®å§¿å‹¢ã«æˆ»ã™ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆ
            const targetTimer = setTimeout(() => {
                 targetEl.classList.remove('shake');
                 if(!gameState.isGameOver) setCharacterPose(targetId, 'idle');
            }, 500); // 0.5ç§’å¾Œã«æˆ»ã‚‹
            
            // ã‚¿ã‚¤ãƒãƒ¼IDã‚’ä¿å­˜ï¼ˆé€£æ‰“å¯¾ç­–ï¼‰
            if (attackerId === 1) p1AnimTimeout = attackerTimer; else p2AnimTimeout = attackerTimer;
            if (targetId === 1) p1AnimTimeout = targetTimer; else p2AnimTimeout = targetTimer;
        }


        // === UIæ›´æ–°ãƒ»ã‚²ãƒ¼ãƒ é€²è¡Œç®¡ç† ===
        
        function updateHpUI() {
            const p1Percent = (gameState.hp1 / MAX_HP) * 100;
            const p2Percent = (gameState.hp2 / MAX_HP) * 100;
            document.getElementById('hp-p1').style.width = `${p1Percent}%`;
            document.getElementById('hp-p2').style.width = `${p2Percent}%`;
        }

        function endGame(winnerId) {
            gameState.isGameOver = true;
            const loserId = (winnerId === 1) ? 2 : 1;

            // æœ€å¾Œã®ãƒãƒ¼ã‚ºã‚’ã‚»ãƒƒãƒˆï¼ˆå‹åˆ©ã¨æ•—åŒ—ï¼‰
            setCharacterPose(winnerId, 'win');
            setCharacterPose(loserId, 'lose');
            // æºã‚Œã‚’æ­¢ã‚ã‚‹
            document.getElementById(`char-p1`).classList.remove('shake');
            document.getElementById(`char-p2`).classList.remove('shake');

            // çµæœç”»é¢è¡¨ç¤º
            setTimeout(() => {
                document.getElementById('win-message').textContent = `P${winnerId} WINS!`;
                document.getElementById('reset-overlay').style.display = 'flex';
            }, 800);
        }

        function resetGame() {
            gameState.hp1 = MAX_HP;
            gameState.hp2 = MAX_HP;
            gameState.isGameOver = false;
            
            updateHpUI();
            // ãƒãƒ¼ã‚ºã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã™
            setCharacterPose(1, 'idle');
            setCharacterPose(2, 'idle');
            
            document.getElementById('reset-overlay').style.display = 'none';
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        setCharacterPose(1, 'idle');
        setCharacterPose(2, 'idle');

    </script>
</body>
</html>